- name: Create containerd config
  ansible.builtin.shell:
    cmd: containerd config default
  register: config

- name: Make folder for containerd configuration
  ansible.builtin.file:
    path: /etc/containerd/
    state: directory
    mode: '741'

- name: Save config to file
  ansible.builtin.copy:
    content: "{{ config.stdout }}"
    dest: /etc/containerd/config.toml

- name: Debug
  ansible.builtin.debug:
    msg: "{{ result.changed }}"    

- name: Restart containerd service
  ansible.builtin.service:
    name: cron
    state: restarted
  when: result.changed

# Получение состояние службы/сервиса на хосте
- name: Get services status
  ansible.builtin.service_facts:

- name: Debug
  ansible.builtin.debug:
    msg: "{{ ansible_facts.services['kubelet.service'].state }}"

# Отключить линтер
tags:
  - skip_ansible_lint